---
title: "Homework 3"
author: "Ericka Smith"
date: "10/14/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(MASS)
```

## Problem 1

```{r fig.height=4, fig.width=4, warning=FALSE}
dat <- data.frame(
  x = c(0, 0.5, 1, 2, 3, 4, 5, 5, 5.5, 6),
  y = c(0, 0, 0, 0, 0, 1, 1, 1, 1, 1))

ggplot(data = dat, aes(x = x, y=y))+
  geom_point(size = 2)+
  geom_smooth(method = "glm", method.args = list(family=binomial), se=F)+
  theme_light()+
  ggtitle("HW3 Problem 1")

summary(glm(y~x, family = binomial, data=dat))
```


For both the intercept and the coefficient for x we get p-values equal to 1, so neither estimate is significant and we can't interpret their values in a very meaningful way. That being said, in a logistic regression output such as this the intercept signifies the log odds of being in the $p(x)=0$ group for y, and the coefficient of x signifies the change in the log odds of being in the $p(x)=1$ group as compared to the $p(x)=0$ group. 


## Problem 2

#### Part A

They are equivalent as parameter points because the constant $c$ falls away in the model, because $\alpha_i=log(w_i)$ and and $+c$ is the only difference between $\alpha_1, ..., \alpha_8$ as compared to $\alpha_1+c, ..., \alpha_8+c$. We can still estimate the weights $w_1,...,w_8$ because we have the relationship between these already.

#### Part B

```{r}
X <- read_csv("p2.csv", col_names = FALSE)
(xmat <- as.matrix(X))
y <- c(5,3,7,6,6,1/3,1/4,1/3,5,3,3,1/5,1/7,6,3,4,6,1/5,1/3,1/4,1/7,1/8,1/2,1/5,1/6,1/5,1/6,1/2)
logy <- map_dbl(y, ~log(.x))
model0 <- lm(y~xmat)
summary(model0)
```

Here are the estimates I obtain:

$\alpha_1-\alpha_2 = -0.6107$

$\alpha_1-\alpha_3 = -2.6166$

$\alpha_1-\alpha_4 = -0.8603$

$\alpha_1-\alpha_5 = -4.3797$

$\alpha_1-\alpha_6 = -3.0619$

$\alpha_1-\alpha_7 = -2.6940$

$\alpha_1-\alpha_8 = -1.2356$

#### Part C

```{r}
exp_a <- unname(exp(model0$coefficients))
w <- rbind(diag(-1,7,7), rep(1,7))
(w <- cbind(w, as.vector(exp_a)))
(z <- c(rep(0,7), 1))
solve(w,z)
```


The estimates of the weights are the following:

$w_1 = 0.8863396439$

$w_2 = 0.0423669649$ 

$w_3 = 0.0057000807$ 

$w_4 = 0.0330094571$ 

$w_5 = 0.0009776181$ 

$w_6 = 0.0036514923$ 

$w_7 = 0.0052754124$ 

$w_8 = 0.0780292078$

#### Part D

Since only certain $\alpha$ estimates were significant that calls into question the hypothesis that all 8 criteria are equally important. The varying magnitudes of the weights also do. For example, $w_5$ is a LOT smaller than the other weights, which leads me to believe that yard space (5) is not actually as important as some of the other criteria.

#### Part E

```{r}
plot(model0)
```

Based on the plots the model assumptions are not quite met. In the Residuals vs. Fitted plot you can see that there is nonconstant variance and on the Q-Q plot there is a bit of tailing off at the upper right hand corner of the plot. 

## Problem 3

#### Parts A and B

```{r}
# dat <- data.frame(
#   insecticide = c(2, 2.64, 3.48, 4.59, 6.06, 8),
#   ddt = c(3/50, 5/49, 19/47, 19/38, 24/49, 35/50),
#   bhc = c(2/50, 14/49, 20/50, 27/50, 41/50, 40/50),
#   both = c(28/50, 37/50, 46/50, 48/50, 48/50, 50/50))
df <- data.frame(
  dose <- c(2, 2.64, 3.48, 4.59, 6.06, 8, 2, 2.64, 3.48, 4.59, 6.06, 8, 2, 2.64, 3.48, 4.59, 6.06, 8),
  kr <- c(3/50, 5/49, 19/47, 19/38, 24/49, 35/50, 2/50, 14/49, 20/50, 27/50, 41/50, 40/50, 28/50, 37/50, 46/50, 48/50, 48/50, 50/50),
  insecticide <- c("DDT", "DDT", "DDT", "DDT", "DDT", "DDT", "BHC", "BHC", "BHC", "BHC", "BHC", "BHC", "BOTH", "BOTH", "BOTH", "BOTH", "BOTH", "BOTH"))

ggplot(data = df)+
  geom_smooth(aes(x = dose, y=kr, color=insecticide), method = "glm", method.args = list(family=binomial), se=F)+
  geom_point(aes(x = dose, y=kr, color=insecticide))+
  theme_light()+
  ggtitle("Toxicity of Insecticides")+
  xlab(as.expression(bquote("Insecticide Dose (mg/10" ~ cm^2 ~ ")")))+
  ylab("Kill Rate")
```

#### Part C

```{r}
mod <- glm(kr ~ log(dose) + insecticide, family="binomial")
ggplot(mod)+
  geom_smooth(aes(log(dose), .fitted, color = insecticide), se = F)+
  theme_light()+
  ggtitle("log(dose) vs. fitted")
```

Looking at the plot of log(dose) vs. fitted values we see that these lines are parallel. This gives evidence to the hypothesis of parallelism.

#### Part D

In the formula chem+ldose there is an intercept term and in the formula chem+ldose-1 there is not. Since this is the only difference the covariance matrices will be the same.

#### Part E

```{r}
a = mod$coefficients[1]    
b = mod$coefficients[2]
V=vcov(mod)
z = 1.645;
k = 1.645^2*V[2,2]/b^2
(tau = polyroot(c(a^2 - V[1,1]*z*z,2*a*b - 2*V[1,2]*z*z,b^2 - V[2,2]*z*z)))
```

The 90% Confidence Interval that I obtain is (-0.0048049, 3.0788096)

#### Part F

```{r}
mod_probit <- glm(kr ~ log(dose) + insecticide, family=binomial(link = "probit"))
mod_cloglog <- glm(kr ~ log(dose) + insecticide, family=binomial(link = "cloglog"))
mod_loglog <- glm((1-kr) ~ log(dose) + insecticide, family=binomial(link="cloglog"))

ggplot(mod_probit)+
  geom_smooth(aes(log(dose), .fitted, color = insecticide), se = F)+
  theme_light()+
  ggtitle("probit model")
ggplot(mod_cloglog)+
  geom_smooth(aes(log(dose), .fitted, color = insecticide), se = F)+
  theme_light()+
  ggtitle("c-log-log model")
ggplot(mod_loglog)+
  geom_smooth(aes(log(dose), .fitted, color = insecticide), se = F)+
  theme_light()+
  ggtitle("log-log model")


a = mod_cloglog$coefficients[1]    
b = mod_cloglog$coefficients[2]
V=vcov(mod_cloglog)
z = 1.645;
k = 1.645^2*V[2,2]/b^2
(tau = polyroot(c(a^2 - V[1,1]*z*z,2*a*b - 2*V[1,2]*z*z,b^2 - V[2,2]*z*z)))
```

It really doesn't seem to me that any of them gives an appreciably better fit. For my 90% confidence interval for the c-log-log model I get (0.532220,4.451669).

#### Part G

```{r}
predict(mod, type = "response")[18]
exp(predict(mod)[18])
```

The closest we can reliably get to 0.99 is 0.98480346, and this occurs at a dose of $64.8 mg/10cm^2$

#### Part H

It seems pretty clear to me based upon the prior plots and models that both insecticides together are the most effective. DDT appears to be less effective than gamma-BHC but the two are fairly similar overall. 