---
title: "problem_3"
author: "Ericka Smith"
date: "11/5/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(magrittr)
```

Load and manipulate data:

```{r}
cotton <- read.table("~/generalized_regression_models/midterm/cotton.txt", quote="\"")
names(cotton) <- c("affected", "not_affected", "race", "sex", "smoking", "employment", "dust")
cotton <- cotton %>%
  mutate(race = recode(race,
                       "1" = "w",
                       "2" = "nw"),
         sex = recode(sex,
                      "1" = "m",
                      "2" = "f")) %>% 
  pivot_longer(c("affected", "not_affected"), names_to = "byss_prev", values_to = "count") %>%
  mutate(byss_prev = recode(byss_prev,
                            "affected" = "1",
                            "not_affected" = "0")) %>%
  uncount(weights = count)
cotton$byss_prev <- as.integer(cotton$byss_prev)
```


## Part A

```{r}
fit <- glm(byss_prev~., family = binomial, data=cotton)
summary(fit)
```

Based on these results smoking, employment, and dust are significant predictors for being affected by bysinnosis ($\alpha = 0.05$, $p_{smoking}=0.00112$, $p_{employment}=0.00031$, $p_{dust}<2*10^{-16}$)

The residual degrees of freedom is calculated by taking $df_{saturated}-df_{proposed}$ where $df_{saturated}$ is for the saturated model, which assumes $n=5419$ parameters, and $df_{proposed}$ is for the proposed model and assumes $p+1= 5+1 =6$ parameters. So we get:

$$
df_{saturated}-df_{proposed}=5419-6=5413
$$

## Part B

The regression coefficient of sex is 0.25290. This can be interpreted as the expected change in log odds (log odds of being affected as compared to not being affected) for a a male as opposed to a female. The odds ratio can the be calculated by exponentiating this value to get 1.287754, which means that we expect to see about **28.8% increase in the odds of being affected by bysinnosis for males over females.**

sexm          0.2590     0.2116   

A 90% confidence interval for the odds ratio (males vs. females) of contracting byssinosis is as follows:

$$
0.2590 \pm 1.65\frac{0.2116}{\sqrt(5419)}
$$

$$
0.2590 \pm 0.004743
$$

$$
(0.254257,0.263743)
$$

$$
(e^{0.254257},e^{0.263743})
$$

$$
(1.289503,1.301794)
$$

## Part C

The excess risk assoicated with cotton dust:
dust          1.3751     0.1155  11.901  < 2e-16



The regression coefficient of dust is 1.3751. This can be interpreted as the expected change in log odds (log odds of being affected as compared to not being affected) for a one step increase in dust level. The odds ratio can the be calculated by exponentiating this value to get 3.955472, which means that **we expect each one step increase in dustiness of work environment level to have an almost 4 times excess risk of being affected by bysinnosis.**

A 90% confidence interval for the excess risk of contracting byssinosis due to increased dustiness is as follows:

$$
1.3751 \pm 1.65\frac{0.1155}{\sqrt(5419)}
$$

$$
1.3751 \pm 0.00259
$$

$$
(1.37251,1.37769)
$$

$$
(e^{1.37251},e^{1.37769})
$$

$$
(3.945241,3.96573)
$$

## Part D

Based on this analysis I can conclude that increased smoking habits and increased length of employment are risk factors for bysinnosis. By far the predictor with the greatest effect though is the dustiness of the work environment.
