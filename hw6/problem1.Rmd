---
title: "problem 1"
author: "Ericka Smith"
date: "11/15/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(GGally)
library(ggpubr)
library(MASS)
```

#### Load data

```{r}
seizure <- read_table2("seizure.txt")
```

Notes on data: 
* 0 is placebo, 1 is progabride
* y1, y2, y3, y4 are counts for seizures for each successive two weeks
* base is number of seizures during baseline 8 wk period

### Part A

```{r}
mod <- glm(y4 ~ age+trt+base, family = "poisson", data = seizure)
summary(mod)
```

```{r warning=FALSE, message=FALSE}
ggpairs(seizure[,4:7])+theme_pubclean()
ggplot(seizure, aes(y = as.factor(trt), x = y4, group=as.factor(trt)))+
  geom_boxplot()+
  theme_pubclean()+
  labs(title = "Treatment Group vs. Number of Seizures in y4 Period",
       x = "Number of Seizures",
       y = "Treatment")+
  scale_y_discrete(labels=c("0" = "placebo", "1" = "progabride"))
ggplot()+
  geom_point(aes(x = seizure$y4, mod$fitted.values))+
  geom_abline(slope = 1, intercept = 0, color = "red", linetype= "dashed")+
  theme_pubclean()+
  labs(title = "Actual vs Fitted Values",
       x = "y4",
       y = "Poisson Model Fitted Values")+
  annotate("text", x=50, y=12, label="y=x is dashed line", color = "red")
```

My plots indicate that base is highly correlated with y4, which makes sense intuitively because frequency of seizures should at least somewhat rely on prior frequency of seizures. I was surprised to see that trt is significant (alpha = 0.05) in the model despite the fact that the boxplot indicates there isn't a difference in means between the treatment and placebo groups. There a a bunch of reasons this could happen though, and so I defer to the model in this instance. The model gives age, trt, and base all as significant predictors of y4 (p=0.02921, p=0.00479, p< 2e-16, respectively). Based on the coefficients it appears that y4 increases with both age and base, but decreases with the treatment. Again though, just because it's a significant predictor in the model does not clearly state that it is causing a decrease in seizures.

### Part B

Residual Analysis
```{r}
glm.evaluate=mod

rp=resid(glm.evaluate, "pearson")
rd=resid(glm.evaluate, "deviance")
rw=resid(glm.evaluate, "working")
rs=rstudent(glm.evaluate)
ra=3*(glm.evaluate$y^{2/3}-glm.evaluate$fit^{2/3})/glm.evaluate$fit^{1/6}/2

par(mfrow=c(2,3))
plot(glm.evaluate$fit,rp, main="Pearson")
plot(glm.evaluate$fit,rd, main = "deviance")
plot(glm.evaluate$fit,rw, main="working")
plot(glm.evaluate$fit,rs, main="student")
plot(glm.evaluate$fit,ra, main="ra")
plot(hatvalues(glm.evaluate), type="h", main="hat")
```

The residual plots indicate that we have a few outliers. Without removing them it's hard to say whether or not the rest of the residuals appear evenly and randomly distributed.

### Part C

```{r}
mod_nb <- glm.nb(y4 ~ age+trt+base, data=seizure)
summary(mod_nb)
```

```{r}
ggplot()+
  geom_point(aes(x = seizure$y4, mod_nb$fitted.values))+
  geom_abline(slope = 1, intercept = 0, color = "red", linetype= "dashed")+
  theme_pubclean()+
  labs(title = "Actual vs Fitted Values",
       x = "y4",
       y = "Negative Binomial Model Fitted Values")+
  annotate("text", x=50, y=12, label="y=x is dashed line", color = "red")
```

Residual Analysis
```{r}
glm.evaluate=mod_nb

rp=resid(glm.evaluate, "pearson")
rd=resid(glm.evaluate, "deviance")
rw=resid(glm.evaluate, "working")
rs=rstudent(glm.evaluate)
ra=3*(glm.evaluate$y^{2/3}-glm.evaluate$fit^{2/3})/glm.evaluate$fit^{1/6}/2

par(mfrow=c(2,3))
plot(glm.evaluate$fit,rp, main="Pearson")
plot(glm.evaluate$fit,rd, main = "deviance")
plot(glm.evaluate$fit,rw, main="working")
plot(glm.evaluate$fit,rs, main="student")
plot(glm.evaluate$fit,ra, main="ra")
plot(hatvalues(glm.evaluate), type="h", main="hat")
```

Based on the fitted values the model isn't perfect, of course, but it provides a decent fit. The residuals indicate a few outliers so it's difficult to stringently evaluate them, but overall they look okay. The model itself only names base as a significant predictor (p<2e-16). Trt is nearly significant at alpha = 0.05, with p= 0.0525. Age however is not even close, with p=0.1802. Base has a positive coefficient so we expect that more seizures at baseline is associated with more seizures during the y4 period. Age is the same (though not a good predictor), and trt is the opposite (though again, not significant predictor).

### Part D

I believe the negative binomial regression does provide a better fit to the data. It has a lower AIC value. That makes sense, since it has two less predictors than the poisson model does. The AIC for the negative binomial model is 314.27, while it is 340.83 for the poisson model. It should also be noted that the Null deviance and Residual deviance are both smaller in the negative binomial model.

I do think it would be worth trying to look at this data in a way that controls for baseline number of seizures better, so as to get a more clear idea of the efficacy of the treatment. That is the major benefit the poisson model has over the negative binomial model, is that it at least includes the trt variable. 

Regardless I believe the negative binomial model is the better fit. 


## Problem 2

![2](2.jpg)